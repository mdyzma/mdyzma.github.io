<!DOCTYPE html>
<html lang="en">

  <!-- Begin Jekyll SEO tag v2.2.3 -->
<title>Social media analysis with Flask, Part II | Consider Python</title>
<meta property="og:title" content="Social media analysis with Flask, Part II" />
<meta name="author" content="Michal Dyzma" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Flask application presenting social media accounts analysis in form of dashboard. It transforms various data sources into clear and concise report. Part II describes creation of landing page and dashboard, including blueprints pattern, jinja templates, login/register mechanism and data storage in development and production." />
<meta property="og:description" content="Flask application presenting social media accounts analysis in form of dashboard. It transforms various data sources into clear and concise report. Part II describes creation of landing page and dashboard, including blueprints pattern, jinja templates, login/register mechanism and data storage in development and production." />
<link rel="canonical" href="http://localhost:4000/2017/08/12/social-media-analysis-part-ii/" />
<meta property="og:url" content="http://localhost:4000/2017/08/12/social-media-analysis-part-ii/" />
<meta property="og:site_name" content="Consider Python" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-08-12T16:11:47+02:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@MichalDyzma" />
<meta name="twitter:creator" content="@Michal Dyzma" />
<meta property="fb:admins" content="mdyzma" />
<meta property="article:publisher" content="mdyzma" />
<meta property="fb:app_id" content="422251294815916" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"Social media analysis with Flask, Part II","author":{"@type":"Person","name":"Michal Dyzma"},"datePublished":"2017-08-12T16:11:47+02:00","dateModified":"2017-08-12T16:11:47+02:00","description":"Flask application presenting social media accounts analysis in form of dashboard. It transforms various data sources into clear and concise report. Part II describes creation of landing page and dashboard, including blueprints pattern, jinja templates, login/register mechanism and data storage in development and production.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/md-logo.png"},"name":"Michal Dyzma"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2017/08/12/social-media-analysis-part-ii/"},"url":"http://localhost:4000/2017/08/12/social-media-analysis-part-ii/"}</script>
<!-- End Jekyll SEO tag -->

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Social media analysis with Flask, Part II</title>
  <meta name="description" content="Flask application presenting social media accounts analysis in form of dashboard. It transforms various data sources into clear and concise report. Part II describes creation of landing page and dashboard, including blueprints pattern, jinja templates, login/register mechanism and data storage in development and production.">
  <meta name="keywords" content="python, twitter, Flask, Jinja2, MongoDB">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2017/08/12/social-media-analysis-part-ii/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Consider Python" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="MichalDyzma">
  <meta name="twitter:title" content="Social media analysis with Flask, Part II">
  <meta name="twitter:description" content="Flask application presenting social media accounts analysis in form of dashboard. It transforms various data sources into clear and concise report. Part II describes creation of landing page and da...">
  
    <meta name="twitter:creator" content="MichalDyzma">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

<!-- Font awesome -->
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  
  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-97434888-1', 'auto');
    ga('send', 'pageview');

  </script>


  
  <!-- Google Adsense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: ca-pub-4566255347044004,
    enable_page_level_ads: true
  });
</script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Consider Python</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/">Home</a>
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="https://github.com/mdyzma/">GitHub</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Social media analysis with Flask, Part II</h1>
    
    <p class="post-meta"><time datetime="2017-08-12T16:11:47+02:00" itemprop="datePublished">Aug 12, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Michal Dyzma</span></span> • 
  
  
    
      <a href="/categories/python/">python</a>,
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/social-media/">social-media</a>,
    
  
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/flask/">Flask</a>,
    
  
    
  
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/jinja2/">Jinja2</a>,
    
  
    
  

  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <a href="/categories/mongodb/">MongoDB</a>
    
  

</p>
  </header>

  <div style="padding: 5px 0 5px 0;">
<span class="reading-time" title="Estimated read time">
  
  
    <i class="fa fa-clock-o" aria-hidden="true"></i> Estimated read time: <b>48 mins </b>
  
</span>
</div>

  <div class="post-content" itemprop="articleBody">

    <p><img src="/assets/2017-08-12/banner.png" alt="banner" /><br />
Flask application presenting social media accounts analysis in form of dashboard. It transforms various data sources into clear and concise report. <strong>Part II</strong> describes creation of landing page and dashboard, including blueprints pattern, jinja templates, login/register mechanism and data storage in development and production.</p>

<p><br /></p>
<div class="alert alert-info" role="alert" style="text-align: justify; vertical-align:middle;">
Source files for this article can be downloaded from this <a href="https://github.com/mdyzma/md_analytics/releases/tag/v0.0.4">GitHub repository</a>
</div>

<hr />

<h2 id="series-consists-of">Series consists of:</h2>

<ul>
  <li><a href="http://localhost:4000/2017/07/07/social-media-analysis-part-I/">Social media analysis with Flask, Part I</a> (Setting environment, flask, Travis CI/Heroku CD )</li>
  <li><a href="http://localhost:4000/2017/08/12/social-media-analysis-part-ii/">Social media analysis with Flask, Part II</a> (Templates, login/register mechanism, data storage)</li>
</ul>

<h2 id="part-ii">Part II</h2>

<ol>
  <li><a href="#project-organization">Project organization</a></li>
  <li><a href="#jinja-engine">Jinja engine</a></li>
  <li><a href="#layout">Layout</a></li>
  <li><a href="#landing-page">Landing page</a></li>
  <li><a href="#login-register-forms">Login / Register forms</a>
    <ul>
      <li><a href="#login">Login</a></li>
      <li><a href="#register">Register</a></li>
    </ul>
  </li>
  <li><a href="#summary">Summary</a></li>
</ol>

<hr />

<h2 id="project--organization">Project  organization</h2>

<p>Flask auto-magically finds templates or static files in the app directory, but it is a good idea to structure things a little.</p>

<p>From organizational point of view, most preferable is modular packaging of files, that specific parts of our application can be moved and adopted to other projects as a whole with its own routing mechanism, static files and templates. Therefore we will write specific components like dashboard or user management and place in separate folders and python packages. So we will have <strong>public</strong> component (in this context component comprises of python package and folder with the same name placed in <code class="highlighter-rouge">templates/</code>) with landing page accessible for all users. And some other components restricted only for logged users i.e. <strong>user</strong> or <strong>dashboard</strong>), which will be placed in separate folders. This kind of packaging allows to produce modular and easy to reuse code.</p>

<p>The landing page is bound to the main endpoint of the app <code class="highlighter-rouge">/</code> and will reside in <code class="highlighter-rouge">public/</code> package. Other have their own endpoints i.e <code class="highlighter-rouge">/users/</code> or <code class="highlighter-rouge">/dashboard/</code>, and are placed in packages specific for them. We will adopt Flask blueprints pattern, which means the basic structure for each component will comprise of blueprint and it’s business logic, which will be registered with the main app.</p>

<p>![app-diagram][app_diag]</p>

<p>Repeatedly used, large blocks of code like <code class="highlighter-rouge">nav</code>, <code class="highlighter-rouge">head</code> or <code class="highlighter-rouge">footer</code> may become quite complicated, therefore it is better to flatten template structure even more and incorporate them as separate <code class="highlighter-rouge">html</code> files from <code class="highlighter-rouge">templates/includes/</code>.</p>

<p>To sum up, each large component will have it’s own folder in the <code class="highlighter-rouge">app/</code> and <code class="highlighter-rouge">template/</code>, to make it maximally portable. Each page will use common set of tools provided by frameworks and stored in <code class="highlighter-rouge">static/</code>.</p>

<p><br /></p>
<ul>
  <li><strong>dashboard</strong>: routs, models, forms, db communication for data presentation</li>
  <li><strong>public</strong>: routs, forms and models for home page</li>
  <li><strong>static</strong>: all static files served by the app, including css styles, JavaScript, images or fonts.</li>
  <li><strong>templates</strong>: basic layout blueprint and error pages
    <ul>
      <li><strong>dashboard</strong>: templates to the dashboard</li>
      <li><strong>includes</strong>: partial HTML snippets for specific purpose i.e. navigation bar, footer, part of templates folder.</li>
      <li><strong>public</strong>: landing page and login/register templates</li>
      <li><strong>user</strong>:  user profile templates</li>
    </ul>
  </li>
  <li><strong>user</strong>:  routes, models, forms and db communication for user data</li>
</ul>

<p><br />
Finally lest focus a bit on the stack of tools which will be used in this application. Obviously back-end is Flask and gunicorn. User data will be stored in <a href="https://www.mongodb.com">MongoDB</a>. Front-end will use two popular frameworks:  <a href="http://getbootstrap.com">Twitter Bootstrap 4</a> to make page responsive and nice without having to write extensive CSS and <a href="https://mdbootstrap.com/material-design-for-bootstrap/">Material Design for Bootstrap</a>, to make things more beautiful. For Bootstrap framework we will need to download already compiled css from Bootstrap’s page files: <code class="highlighter-rouge">bootstrap.min.css</code> and <code class="highlighter-rouge">bootstrap.min.js</code>. Bootstrap relies on jQuery, a JavaScript framework that provides a layer of abstraction in most common JavaScript operations (i.e. element selection, events handling). Therefore we should also add latest JQuery library <code class="highlighter-rouge">jquery-3.2.1.min.js</code> to our files. For MDB we will need <code class="highlighter-rouge">mdb.min.css</code>, <code class="highlighter-rouge">mdb.min.js</code> and <code class="highlighter-rouge">popper.min.js</code>. They will spice up our web site and give lots of good solutions and JavaScript functionalities to it. Files should be placed in appropriate static sub-folders:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">(</span>md_analytics<span class="o">)</span> <span class="o">[</span>mdyzma@devbox md_analytics]<span class="nv">$ </span>tree .
.
|-- app/
|   |-- public/
|   |   |-- __init__.py
|   |   |-- forms.py
|   |   <span class="sb">`</span>-- views.py
|   |
|   |-- static/
|   |   |-- css/
|   |   |   |-- bootstrap.min.css
|   |   |   |-- mdb.min.css
|   |   |   <span class="sb">`</span>-- style.css
|   |   |
|   |   |-- font/
|   |   |
|   |   |-- img/
|   |   |
|   |   |-- js/
|   |   |   |-- bootstrap.min.js
|   |   |   |-- jquery-3.2.1.min.js
|   |   |   |-- mdb.min.js
|   |   |   <span class="sb">`</span>-- popper.min.js
|   |   <span class="sb">`</span>-- favicon.ico
|   |
|   |-- templates/
|   |   |
|   |   |-- dashboard/
|   |   |
|   |   |-- includes/
|   |   |-- |-- contact.html
|   |   |   |-- footer.html
|   |   |   |-- meta.html
|   |   |   |-- messages.html
|   |   |   <span class="sb">`</span>-- nav.html
|   |   |   
|   |   |-- public/
|   |   |   |-- home.html
|   |   |   |-- login.html
|   |   |   <span class="sb">`</span>-- register.html
|   |   |
|   |   |-- user/
|   |   |   <span class="sb">`</span>-- profile.html
|   |   |
|   |   |-- 404.html
|   |   <span class="sb">`</span>-- layout.html
|   |
|   |-- __init__.py
|   |-- app.py
|   |-- extensions.py
|   |-- settings.py
...</code></pre></figure>

<h2 id="jinja-engine">Jinja engine</h2>

<p>Flask uses very powerful and flexible template engine called <a href="http://jinja.pocoo.org"><strong>Jinja2</strong></a>. It allows to define website in small blocks, one by one, which then are pieced together, to form complete HTML pages. The power of Jinja relies on possibility to push some portion of logic like iterations over containers or table rows, some flow control with <code class="highlighter-rouge">if</code> or <code class="highlighter-rouge">while</code> statements, some text processing capabilities like filtering, even mathematical operations and files handling. All this can be accedes from the web HTML template level. Still most important feature of Jinja is template inheritance mechanism similar to class inheritance in python. Basic layout template provides set of blocks, which can be overridden by the content of the specific page. Also changes, or bugs fixes are much easier, since the HTML for each part of the site exists in one place - template file.</p>

<p>In templates we will use several Jinja elements, which will build dynamic structure skeleton. Most frequently used Jinja elements are so called statements (enclosed in <code class="highlighter-rouge"><span class="p">{</span><span class="err">%</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="err">%</span><span class="p">}</span></code>) and expressions (enclosed in  <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code>). Statements provide different means of the work-flow control, for example <code class="highlighter-rouge">if</code>, <code class="highlighter-rouge">with</code> conditionals or <code class="highlighter-rouge">for</code> loops and some pre-defined Jinja tags i.e. <code class="highlighter-rouge">block</code>, <code class="highlighter-rouge">include</code>, <code class="highlighter-rouge">call</code>. Expressions, on the other hand, display dictionary based variables passed to the engine via Flask context mechanism. For more details, please refer to the <a href="http://jinja.pocoo.org">Jinja documentation</a>.</p>

<h2 id="layout">Layout</h2>

<p>In our template we have specified several large code blocks, which will be filled with details in children templates. The most basic template, the architectural foundation for each page of our application, is called <code class="highlighter-rouge">layout.html</code>. It contains all elements required by the browser to serve modern page and are common for entire project. It also includes links to the framework files used in the project (<code class="highlighter-rouge">.css</code> and <code class="highlighter-rouge">.js</code>). From our point of view most important sections are:</p>

<ul>
  <li><strong>head</strong> section:
    <ul>
      <li><strong>title</strong> - dynamic tab title</li>
      <li><strong>meta</strong> - with necessary metadata and responsive design directives</li>
      <li><strong>seo</strong>  - for proper SEO information like Open Graph and Twitter cards</li>
      <li><strong>styles</strong> - place for custom css styles present at specific page</li>
    </ul>
  </li>
  <li><strong>body</strong> :
    <ul>
      <li><strong>nav</strong> - where we place navigation bar common for all pages</li>
      <li><strong>messages</strong> - part displaying application messages to the user</li>
      <li><strong>intro</strong>  - part specific for landing page</li>
      <li><strong>content</strong> block - different content on each page</li>
      <li><strong>contact</strong> block - contact info/form</li>
      <li><strong>footer</strong> section - basic structural element with extended footer information like site map, and other links</li>
    </ul>
  </li>
</ul>

<p>Base template with all the links to partial templates and code blocks should look similar to this:</p>

<p><strong>/templates/layout.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></td><td class="code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>{% block title %}{% endblock %} | MD-Analytics<span class="nt">&lt;/title&gt;</span>
        <span class="c">&lt;!-- Head section meta from include --&gt;</span>
        {% include 'includes/meta.html' ignore missing %}
        {% block seo %}{% endblock %}
        {% block styles %}{% endblock %} 
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;header&gt;</span>
            <span class="c">&lt;!-- Top navigation bar from include --&gt;</span>
            {% include 'includes/nav.html' ignore missing %}
            <span class="c">&lt;!-- Messages flashed to the user --&gt;</span>
            {% include 'includes/messages.html' ignore missing %}
            <span class="c">&lt;!-- Landing page intro, carousel and other  --&gt;</span>
            {% block intro %}{% endblock %}
        <span class="nt">&lt;/header&gt;</span>
        <span class="nt">&lt;main&gt;</span>
            <span class="c">&lt;!-- Main content block --&gt;</span>
            {% block content %}{% endblock %}
            {% block contact %}{% endblock %}
        <span class="nt">&lt;/main&gt;</span>
            <span class="c">&lt;!-- Footer from include --&gt;</span>
            {% include 'includes/footer.html' ignore missing %}
            <span class="c">&lt;!-- jQuery (jQuery may be replaced with other modern JS library to manipulate DOM i.e. `vue.js`) --&gt;</span>
            <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/JavaScript"</span> <span class="na">src=</span><span class="s">"{{ url_for('static', filename='js/jquery-3.2.1.min.js') }}"</span><span class="nt">&gt;&lt;/script&gt;</span>
            <span class="c">&lt;!-- popper --&gt;</span>
            <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/JavaScript"</span> <span class="na">src=</span><span class="s">"{{ url_for('static', filename='js/popper.min.js') }}"</span><span class="nt">&gt;&lt;/script&gt;</span>
            <span class="c">&lt;!-- Bootstrap core JavaScript --&gt;</span>
            <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/JavaScript"</span> <span class="na">src=</span><span class="s">"{{ url_for('static', filename='js/bootstrap.min.js') }}"</span><span class="nt">&gt;&lt;/script&gt;</span>
            <span class="c">&lt;!-- MDB core JavaScript --&gt;</span>
            <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/JavaScript"</span> <span class="na">src=</span><span class="s">"{{ url_for('static', filename='js/mdb.min.js') }}"</span><span class="nt">&gt;&lt;/script&gt;</span>
            <span class="c">&lt;!--Google Maps--&gt;</span>
            <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://maps.google.com/maps/api/js"</span><span class="nt">&gt;&lt;/script&gt;</span>
            {% block scripts %}
            <span class="c">&lt;!-- Smooth scrolling to the target anchor --&gt;</span>
                <span class="nt">&lt;script&gt;</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s1">'a'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s1">'html, body'</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
                            <span class="na">scrollTop</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span> <span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span>
                        <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
                        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="nt">&lt;/script&gt;</span>
            {% endblock %}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h3 id="head-section">Head section</h3>

<p>Some fragments of HTML are moved to separate <code class="highlighter-rouge">html</code> files to keep main template lean and understandable. Fragments like main navigation bar or footer can be quite large and it could affect code readability. Base includes are located in <code class="highlighter-rouge">app/templates/includes/</code> and will be described separately.</p>

<p>Alongside large <code class="highlighter-rouge">meta.html</code> include there are other blocks building head section of the page. They will differ for specific pages. All special parts of head section are enclosed in separate code blocks: <code class="highlighter-rouge">title</code>, <code class="highlighter-rouge">seo</code> and <code class="highlighter-rouge">styles</code> blocks. Title dynamically manages page title on the tab. SEO is responsible for specific meta information related to page promoting in social media i.e Open Graph tags and other <code class="highlighter-rouge">meta</code> properties used during linking specific page in popular services. If people want to share it on Facebook, LinkedIn, WhatsApp etc, we can control the appearance of “sharing previews” of a website by means of Open Graph meta tags. There is also additional <code class="highlighter-rouge">styles</code> block, which is empty in basic template, but allows to incorporate additional css for each child page.</p>

<p>Meta part from head section of the page contains meta information common for entire project, like links to the style sheets or fonts, information for proper indexing by search engines or gathering page statistics i.e. from Google analytics:</p>

<p><strong>/templates/includes/meta.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">"Social media analytic tool"</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"author"</span> <span class="na">content=</span><span class="s">"Michal Dyzma"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- Fonts --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://fonts.googleapis.com/css?family='Fontdiner+Swanky'"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- Bootstrap CSS --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">stylesheet</span> <span class="na">type=</span><span class="s">text/css</span> <span class="na">href=</span><span class="s">"{{ url_for('static', filename='css/bootstrap.min.css') }}"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- Bootstrap Material Design --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">stylesheet</span> <span class="na">type=</span><span class="s">text/css</span> <span class="na">href=</span><span class="s">"{{ url_for('static', filename='css/mdb.min.css') }}"</span><span class="nt">&gt;</span>
<span class="c">&lt;!-- Your custom styles (optional) --&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">stylesheet</span> <span class="na">type=</span><span class="s">text/css</span> <span class="na">href=</span><span class="s">"{{ url_for('static', filename='css/style.css') }}"</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"shortcut icon"</span> <span class="na">href=</span><span class="s">"{{ url_for('static', filename='favicon.ico') }}"</span><span class="nt">&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Order of linked css is important. The latter file will overwrite same functionalities from the previous one.</p>

<h3 id="body-section">Body section</h3>

<p>Body section contains several distinct blocks: <code class="highlighter-rouge">navbar.html</code>, <code class="highlighter-rouge">messages.html</code>, <code class="highlighter-rouge">intro</code> and <code class="highlighter-rouge">footer.html</code>. Last is <code class="highlighter-rouge">scripts</code> block which allows to include site specific JS scripts at the end of the page. It is considered best practice to place JS scripts near closing body tag, which speeds up page loading and ensures, that all page is already rendered, when scripts start to invoke <strong>DOM (Document Object Model)</strong> operations.</p>

<p>Main navigation bar is common for all pages in the app and will be fixed at the top of the site. It is pretty standard navigation bar, based on Bootstrap and MDB. There is also some Flask helper function enclosed in Jinja variable <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">url_for('index')</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> to manage finding url for main entry point for our application, which is landing page.</p>

<p><strong>/templates/includes/nav.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre><span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"navbar navbar-expand-lg navbar-dark elegant-color-dark justify-content-between"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"{{ url_for('index') }}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;strong</span> <span class="na">style=</span><span class="s">"font-family:'Fontdiner Swanky', cursive;"</span><span class="nt">&gt;</span>MD ANALYTICS<span class="nt">&lt;/strong&gt;</span>
    <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"navbar-toggler"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">data-toggle=</span><span class="s">"collapse"</span> <span class="na">data-target=</span><span class="s">"#navbarSupportedContent"</span> <span class="na">aria-controls=</span><span class="s">"navbarSupportedContent"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span> <span class="na">aria-label=</span><span class="s">"Toggle navigation"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"navbar-toggler-icon"</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"collapse navbar-collapse"</span> <span class="na">id=</span><span class="s">"navbarSupportedContent"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"navbar-nav mr-auto"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"http://md_analytics.readthedocs.io/en/latest/?badge=latest"</span><span class="nt">&gt;</span>Documentation<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"https://github.com/mdyzma/md_analytics"</span><span class="nt">&gt;</span>GitHub<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"{{ url_for('public.home') }}#contact"</span><span class="nt">&gt;</span>Contact<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"navbar-nav ml-auto"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"nav-item"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"nav-link"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Sign Up!<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/nav&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><img src="/assets/2017-08-12/navbar.png" alt="main-navigation" /></p>

<p>Later we will expand it with some logic for sessions and accessing restricted pages.</p>

<p>Messages box, will display all communicates produced by application. Every feedback improves tremendously user experience with the app. It consists of simple div and some Jinja logic to manage messages produced by Flask:</p>

<p><strong>/templates/includes/messages.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-{{ category }} alert-dismissible"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"close"</span> <span class="na">data-dismiss=</span><span class="s">"alert"</span> <span class="na">aria-label=</span><span class="s">"Close"</span><span class="nt">&gt;&lt;span</span> <span class="na">aria-hidden=</span><span class="s">"true"</span><span class="nt">&gt;</span><span class="ni">&amp;times;</span><span class="nt">&lt;/span&gt;&lt;/button&gt;</span>
                    {{ message }}
                <span class="nt">&lt;/div&gt;</span>
            {% endfor %}
        {% endif %}
    {% endwith %}
<span class="nt">&lt;/div&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>At some point we will also try to include contact information. For now it is map with marked location (using Google Map API) and some contact details.</p>

<p><strong>/templates/includes/contact.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="c">&lt;!--Section: Contact--&gt;</span>
<span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"contact pb-5"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!--First column--&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-8 mb-5"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"map-container"</span> <span class="na">class=</span><span class="s">"z-depth-1 wow fadeIn"</span> <span class="na">style=</span><span class="s">"height: 300px"</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="c">&lt;!--/First column--&gt;</span>
        <span class="c">&lt;!--Second column--&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"text-center list-unstyled"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"wow fadeIn"</span> <span class="na">data-wow-delay=</span><span class="s">"0.2s"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-map-marker teal-text fa-lg"</span><span class="nt">&gt;&lt;/i&gt;</span>
                    <span class="nt">&lt;p&gt;</span>Gen. Grochowskiego 55/55<span class="nt">&lt;/p&gt;</span>
                    <span class="nt">&lt;p&gt;</span>Piaseczno, 55-555 , Poland<span class="nt">&lt;/p&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"wow fadeIn mt-5 pt-2"</span> <span class="na">data-wow-delay=</span><span class="s">"0.3s"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-phone teal-text fa-lg"</span><span class="nt">&gt;&lt;/i&gt;</span>
                    <span class="nt">&lt;p&gt;</span>+ 48 555 55 55 55<span class="nt">&lt;/p&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"wow fadeIn mt-5 pt-2"</span> <span class="na">data-wow-delay=</span><span class="s">"0.4s"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-envelope teal-text fa-lg"</span><span class="nt">&gt;&lt;/i&gt;</span>
                    <span class="nt">&lt;p&gt;</span>mdyzma@gmail.com<span class="nt">&lt;/p&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="c">&lt;!--/Second column--&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/section&gt;</span>
<span class="c">&lt;!--Section: Contact--&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><img src="/assets/2017-08-12/contact.png" alt="contact" /></p>

<p>Footer part will be also common to all pages. It will include some extended information about policies, social media links and other standard “footer content”. Code snippet bellow is just simple copyright tag and two column structure for extended content.</p>

<p><strong>/templates/includes/footer.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></td><td class="code"><pre><span class="c">&lt;!--Footer--&gt;</span>
<span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">"page-footer blue center-on-small-only"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--Footer Links--&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--First column--&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;</span>MD Analytics<span class="nt">&lt;/h5&gt;</span>
                <span class="nt">&lt;p&gt;</span>Here you can use rows and columns here to organize your footer content.<span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="c">&lt;!--/.First column--&gt;</span>
            <span class="c">&lt;!--Second column--&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;</span>Links<span class="nt">&lt;/h5&gt;</span>
                <span class="nt">&lt;ul&gt;</span>
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#!"</span><span class="nt">&gt;</span>Link 1<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#!"</span><span class="nt">&gt;</span>Link 2<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#!"</span><span class="nt">&gt;</span>Link 3<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"#!"</span><span class="nt">&gt;</span>Link 4<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="c">&lt;!--/.Second column--&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!--/.Footer Links--&gt;</span>
    <span class="c">&lt;!--Copyright--&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"footer-copyright"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
            <span class="err">&amp;</span>copy 2017 Copyright: <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://www.MDBootstrap.com"</span><span class="nt">&gt;</span> MDBootstrap.com <span class="err">&amp;</span>amp Michal Dyzma<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!--/.Copyright--&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
<span class="c">&lt;!--/.Footer--&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><img src="/assets/2017-08-12/footer.png" alt="footer" /></p>

<p>This is just an example from MDB tutorial. Exact code for footer can be downloaded from the <a href="https://github.com/mdyzma/md_analytics/blob/master/app/templates/includes/footer.html">footer template on GitHub</a>.</p>

<p>Putting it all together we are ready to create first page for our app - the landing page!</p>

<h2 id="landing-page">Landing page</h2>

<p>It is time to expand main application and put in use templates created above. First we will create web page endpoints, add some basic extensions to it and display everything as a nice, responsive landing page.</p>

<h3 id="blueprint">Blueprint</h3>

<p>Earlier, when project organization was explained I mentioned all components will reside in their own folders to maximize portability. Landing page (home) resides in <code class="highlighter-rouge">public</code> folder and this part of the application can be accessed by anyone. Folder contains blueprint for landing page and login/register forms. Folder with the same name was also placed in <code class="highlighter-rouge">templates/</code>, to store necessary html boilerplate. To move this functionality  to other app one has to copy both public folder to new location and make necessary imports.</p>

<p>Blueprint contains all routing for the pages that have something common. For now  our landing page contains only few routs: <code class="highlighter-rouge">/</code> to render <strong>home</strong> page, <code class="highlighter-rouge">/login</code> and <code class="highlighter-rouge">/register</code> to display <strong>login</strong> and <strong>register</strong> forms. For now each method renders specific template. Login and register will be updated in the next section, where we will add data storage layer, safe database communication and sessions.</p>

<p><strong>/app/public/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">redirect</span>


<span class="n">home</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s">'public'</span><span class="p">,</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s">'../static'</span><span class="p">)</span>


<span class="nd">@home.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="s">"""Home page."""</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'public/home.html'</span><span class="p">)</span>


<span class="nd">@home.route</span><span class="p">(</span><span class="s">'/login'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="s">"""Login form."""</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'public/login.html'</span><span class="p">)</span>


<span class="nd">@home.route</span><span class="p">(</span><span class="s">'/register'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="s">"""Register form."""</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'public/register.html'</span><span class="p">)</span>


<span class="nd">@home.route</span><span class="p">(</span><span class="s">'/logout'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="s">"""Logout link."""</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><br />
Once all endpoints and functions are ready, we have to register blueprint with main app. But before we do that, lets refactor our app. We will use several flask extensions, which will help to develop certain functionalities very fast. There is no need to develop wheel again. Instead of writing our own data-base models, login classes etc, we can use already existing solutions i.e. extensions. Extensions will reside in separate file <code class="highlighter-rouge">extensions.py</code>, where they will be instantiated. Separate function will bind existing extension instances with the current app. First lets create extension’s package:</p>

<p><strong>/app/extensions.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">flask_debugtoolbar</span> <span class="kn">import</span> <span class="n">DebugToolbarExtension</span>

<span class="n">debug_toolbar</span> <span class="o">=</span> <span class="n">DebugToolbarExtension</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>We will repeat this pattern with all Flask extensions. Having extensions ready we can register everything with main application:</p>

<p><strong>/app/app.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">app.extensions</span> <span class="kn">import</span> <span class="n">debug_toolbar</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">public</span>

<span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">config_object</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">config_object</span><span class="p">)</span>
    <span class="n">register_extensions</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>


<span class="k">def</span> <span class="nf">register_extensions</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="s">"""Register Flask extensions."""</span>
    <span class="n">debug_toolbar</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Debug toolbar initialized"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">register_blueprints</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="s">"""Register Flask blueprints."""</span>
    <span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">public</span><span class="o">.</span><span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This file will initialize flask app, register all extensions and blueprints to the current context. We can print all endpoints using <code class="highlighter-rouge">manage.py show-urls</code> command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">(</span>md_analytics<span class="o">)</span> <span class="o">[</span>mdyzma@devbox md_analytics]<span class="nv">$ </span>python manage.py show-urls

--------------------------------------------------------------------------------
DEBUG <span class="k">in </span>app <span class="o">[</span>/home/mdyzma/md_analytics/app/app.py:27]:
Debug toolbar initialized
--------------------------------------------------------------------------------
Rule                                          Endpoint
---------------------------------------------------------------------------
/                                             public.home
/login                                        public.login
/logout                                       public.logout
/register                                     public.register
<span class="gp">/static/&lt;path:filename&gt;                       </span>static
<span class="gp">/static/&lt;path:filename&gt;                       </span>public.</code></pre></figure>

<h3 id="template">Template</h3>

<p>Landing page template is located in <code class="highlighter-rouge">templates/public/home.html</code>. Because it inherits all traits of <code class="highlighter-rouge">layout.html</code> it will contain only elements which differ between this two templates. Rest will be provided from base. First we should tell Jinja what template we are extending and populate current home template with site-specific content. Lets add “intro” for our page:</p>

<p><strong>/templates/public/home.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td class="code"><pre>{% extends "layout.html" %}
<span class="c">&lt;!-- Title for each page --&gt;</span>
{% block title %}Home{% endblock %}
<span class="c">&lt;!-- Site Specific Styles --&gt;</span>
{% block styles %}
<span class="nt">&lt;style&gt;</span>
    <span class="c">/* TEMPLATE STYLES */</span>
    <span class="nc">.flex-center</span> <span class="p">{</span>
        <span class="nl">color</span><span class="p">:</span> <span class="m">#fff</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nc">.intro-1</span> <span class="p">{</span>
        <span class="nl">background</span><span class="p">:</span> <span class="sx">url("https://mdbootstrap.com/img/Photos/Horizontal/Work/full page/img%20(2)</span><span class="p">.</span><span class="n">jpg</span><span class="err">"</span><span class="p">)</span><span class="nb">no-repeat</span> <span class="nb">center</span> <span class="nb">center</span><span class="p">;</span>
        <span class="nl">background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>
{% endblock %}
<span class="c">&lt;!--Intro Section--&gt;</span>
{% block intro %}
<span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"view intro-1 hm-black-strong"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"full-bg-img flex-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ul&gt;</span>
                <span class="nt">&lt;li&gt;</span>
                    <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"h1-responsive font-bold wow fadeInDown"</span> <span class="na">data-wow-delay=</span><span class="s">"0.2s"</span><span class="nt">&gt;</span>What is your story?<span class="nt">&lt;/h1&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;</span>
                    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead mt-4 mb-5 wow fadeInDown"</span><span class="nt">&gt;</span>Learn what kind of footprint you created in the web...<span class="nt">&lt;/p&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">target=</span><span class="s">"_blank"</span> <span class="na">href=</span><span class="s">"https://mdbootstrap.com/getting-started/"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-lg wow fadeInLeft"</span> <span class="na">data-wow-delay=</span><span class="s">"0.2s"</span> <span class="na">rel=</span><span class="s">"nofollow"</span><span class="nt">&gt;</span>Sign up!<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">target=</span><span class="s">"_blank"</span> <span class="na">href=</span><span class="s">"https://mdbootstrap.com/material-design-for-bootstrap/"</span> <span class="na">class=</span><span class="s">"btn btn-default btn-lg wow fadeInRight"</span> <span class="na">data-wow-delay=</span><span class="s">"0.2s"</span> <span class="na">rel=</span><span class="s">"nofollow"</span><span class="nt">&gt;</span>Learn more<span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/section&gt;</span>
{% endblock %}<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Intro should be fully scalable and adjust to the screen width. We can expand page further, adding other typical elements like About section, cards with features, testimonials etc…</p>

<p><img src="/assets/2017-08-12/intro.png" alt="intro" /></p>

<p><code class="highlighter-rouge">content</code> block will only have some random <strong>“About”</strong> section and some <strong>“contact”</strong> info with simple Google map with a marker. It is just exemplary content from MDB tutorial to show framework’s capabilities. I would like to focus this blog series more on back-end part of the project, therefore front will be limited to the bare minimum.</p>

<p><strong>/templates/public/home.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108</pre></td><td class="code"><pre><span class="c">&lt;!-- Content --&gt;</span>
{% block content %}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"divider-new pt-5"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"h2-responsive wow fadeIn"</span> <span class="na">data-wow-delay=</span><span class="s">"0.2s"</span><span class="nt">&gt;</span>About me<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!--Section: About--&gt;</span>
    <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"about"</span> <span class="na">class=</span><span class="s">"text-center wow fadeIn"</span> <span class="na">data-wow-delay=</span><span class="s">"0.2s"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;</span>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Velit explicabo assumenda eligendi ex exercitationem harum deleniti quaerat beatae ducimus dolor voluptates magnam, reiciendis pariatur culpa tempore quibusdam quidem, saepe eius.<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;</span>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Velit explicabo assumenda eligendi ex exercitationem harum deleniti quaerat beatae ducimus dolor voluptates magnam, reiciendis pariatur culpa tempore quibusdam quidem, saepe eius.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
    <span class="c">&lt;!--Section: About--&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"features"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- dummy section for link --&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
       <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"divider-new pt-5"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"h2-responsive wow fadeIn"</span><span class="nt">&gt;</span>Best features<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="c">&lt;!--Section: Best features--&gt;</span>
        <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"best-features"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row pt-3"</span><span class="nt">&gt;</span>
                <span class="c">&lt;!--First columnn--&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 mb-r"</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!--Card--&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card wow fadeIn"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card image--&gt;</span>
                        <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"img-fluid"</span> <span class="na">src=</span><span class="s">"https://mdbootstrap.com/img/Photos/Horizontal/Work/4-col/img%20(25).jpg"</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card content--&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
                            <span class="c">&lt;!--Title--&gt;</span>
                            <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title text-center"</span><span class="nt">&gt;</span>360 Advertising<span class="nt">&lt;/h4&gt;</span>
                            <span class="nt">&lt;hr&gt;</span>
                            <span class="c">&lt;!--Text--&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>Some quick example text to build on the card title and make up the bulk of the card's content.<span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="c">&lt;!--/.Card--&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="c">&lt;!--First columnn--&gt;</span>
                <span class="c">&lt;!--Second columnn--&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 mb-r"</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!--Card--&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card wow fadeIn"</span> <span class="na">data-wow-delay=</span><span class="s">"0.2s"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card image--&gt;</span>
                        <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"img-fluid"</span> <span class="na">src=</span><span class="s">"https://mdbootstrap.com/img/Photos/Horizontal/Work/4-col/img%20(14).jpg"</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card content--&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
                            <span class="c">&lt;!--Title--&gt;</span>
                            <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title text-center"</span><span class="nt">&gt;</span>Top-class Team<span class="nt">&lt;/h4&gt;</span>
                            <span class="nt">&lt;hr&gt;</span>
                            <span class="c">&lt;!--Text--&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>Some quick example text to build on the card title and make up the bulk of the card's content.<span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="c">&lt;!--/.Card--&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="c">&lt;!--Second columnn--&gt;</span>
                <span class="c">&lt;!--Third columnn--&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 mb-r"</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!--Card--&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card wow fadeIn"</span> <span class="na">data-wow-delay=</span><span class="s">"0.4s"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card image--&gt;</span>
                        <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"img-fluid"</span> <span class="na">src=</span><span class="s">"https://mdbootstrap.com/img/Photos/Horizontal/Work/4-col/img%20(21).jpg"</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card content--&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
                            <span class="c">&lt;!--Title--&gt;</span>
                            <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title text-center"</span><span class="nt">&gt;</span>Top-class Team<span class="nt">&lt;/h4&gt;</span>
                            <span class="nt">&lt;hr&gt;</span>
                            <span class="c">&lt;!--Text--&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>Some quick example text to build on the card title and make up the bulk of the card's content.<span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="c">&lt;!--/.Card--&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="c">&lt;!--Third columnn--&gt;</span>
                <span class="c">&lt;!--First columnn--&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-lg-3 mb-r"</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!--Card--&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card wow fadeIn"</span> <span class="na">data-wow-delay=</span><span class="s">"0.6s"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card image--&gt;</span>
                        <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"img-fluid"</span> <span class="na">src=</span><span class="s">"https://mdbootstrap.com/img/Photos/Horizontal/Work/4-col/img%20(37).jpg"</span> <span class="na">alt=</span><span class="s">"Card image cap"</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!--Card content--&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
                            <span class="c">&lt;!--Title--&gt;</span>
                            <span class="nt">&lt;h4</span> <span class="na">class=</span><span class="s">"card-title text-center"</span><span class="nt">&gt;</span>24/7 Support<span class="nt">&lt;/h4&gt;</span>
                            <span class="nt">&lt;hr&gt;</span>
                            <span class="c">&lt;!--Text--&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span><span class="nt">&gt;</span>Some quick example text to build on the card title and make up the bulk of the card's content.<span class="nt">&lt;/p&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="c">&lt;!--/.Card--&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="c">&lt;!--First columnn--&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/section&gt;</span>
        <span class="c">&lt;!--/Section: Best features--&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"contact"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- dummy section for link --&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"divider-new"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"h2-responsive wow fadeIn"</span><span class="nt">&gt;</span>Contact<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        {% block contact %}
            {% include 'includes/contact.html' %}
        {% endblock %}
    <span class="nt">&lt;/div&gt;</span>
    <span class="c">&lt;!--/ Main container--&gt;</span>
{% endblock %}<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><img src="/assets/2017-08-12/content.png" alt="content" /></p>

<p>Last but not least, lets add JS script to navigate Google map and place marker in position of our choice. More about Google maps APIs can be found <a href="https://developers.google.com/maps/documentation/javascript/adding-a-google-map">here</a>.</p>

<p><strong>/templates/public/home.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre>{% block scripts %}
    {{ super() }}
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">function</span> <span class="nx">init_map</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">var_location</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">LatLng</span><span class="p">(</span><span class="mf">52.0690115</span><span class="p">,</span> <span class="mf">21.0198418</span><span class="p">,);</span>
            <span class="kd">var</span> <span class="nx">var_mapoptions</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">center</span><span class="p">:</span> <span class="nx">var_location</span><span class="p">,</span>
                <span class="na">zoom</span><span class="p">:</span> <span class="mi">15</span>
            <span class="p">};</span>
            <span class="kd">var</span> <span class="nx">var_marker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Marker</span><span class="p">({</span>
                <span class="na">position</span><span class="p">:</span> <span class="nx">var_location</span><span class="p">,</span>
                <span class="na">map</span><span class="p">:</span> <span class="nx">var_map</span><span class="p">,</span>
                <span class="na">title</span><span class="p">:</span> <span class="s2">"New York"</span>
            <span class="p">});</span>
            <span class="kd">var</span> <span class="nx">var_map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"map-container"</span><span class="p">),</span>
                <span class="nx">var_mapoptions</span><span class="p">);</span>
            <span class="nx">var_marker</span><span class="p">.</span><span class="nx">setMap</span><span class="p">(</span><span class="nx">var_map</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">google</span><span class="p">.</span><span class="nx">maps</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">addDomListener</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">'load'</span><span class="p">,</span> <span class="nx">init_map</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
{% endblock %}<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>You may have noticed <code class="highlighter-rouge"><span class="p">{</span><span class="err">{</span><span class="w"> </span><span class="err">super()</span><span class="w"> </span><span class="p">}</span><span class="err">}</span></code> expression in scripts block. In <code class="highlighter-rouge">layout.html</code> I placed some JS code to be present in all pages. Code is responsible for smooth scrolling to the page internal link. Calling <code class="highlighter-rouge">super()</code> allows to keep all previous content of the block from previous template and append new content to it. So we have smooth scrolling and Google maps initialization. For now we have only two functions, so it is reasonable to keep them in template code. But when amount of custom JS grows it is better to migrate to separate <code class="highlighter-rouge">.js</code> file and serve it from static folder same as framework files.</p>

<p>Obviously I am no web designer, but this simple stub should do the trick. Also we can see that  Bootstrap and MDB gave us nice look and responsive design (hamburger button which expands to full navigation bar when shrunk below 768 pixels, material style of the buttons and navigation bar). There is additional element on the page - a very nice tool to debug flask web applications called <code class="highlighter-rouge">Flask-debugtoolbar</code>. It should be listed in dev requirements and installed automatically during environment configuration. It appears on the page as a button at the right top corner and allows to track current Flask session including app configuration, requests, routing, variables and many more.</p>

<p><img src="/assets/2017-08-12/home-fdt.png" alt="home-fdt" /></p>

<!-- 

### Testing landing page
 -->

<h2 id="login-register-forms">Login, Register forms</h2>

<p>It is time to secure our app. Basic tools for us will be login/register mechanism, which will allow app to securely exchange information with the server, second would be creating sessions and above all encryption of data exchange. To extract information from the server app uses HTTP <code class="highlighter-rouge">GET</code> method, whereas to send information to the server it uses <code class="highlighter-rouge">POST</code> method. There are other methods used in HTTP protocol, but we will focus on these two for now. Login and register forms will base on this two to communicate with the database, which will store information about users (see next <a href="#user-data-management">section</a>). Only logged users will be allowed to see dashboard. In addition logged users can see their own profile with the data app is keeping about them. Lets start with login page.</p>

<h3 id="login">Login</h3>

<p>First lets create login page with all fields, nothing fancy, just simple form with a bit of styling:</p>

<p><strong>/templates/login.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre>{% extends "layout.html" %}
{% set title = "Register" %}
{% block intro %}
<span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"view"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span> <span class="na">style=</span><span class="s">"padding-top: 75px"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Login<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span&gt;</span>Email: <span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span><span class="err">,</span> <span class="na">required=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;span&gt;</span>Password: <span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span><span class="err">,</span> <span class="na">required=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/section&gt;</span>
{% endblock %}<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><img src="/assets/2017-08-12/login.png" alt="login" /></p>

<h3 id="register">Register</h3>

<p>Now very, very simple register form:</p>

<p><strong>/templates/register.html</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre>{% extends "layout.html" %}
{% set title = "Register" %}
{% block intro %}
<span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"view"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span> <span class="na">style=</span><span class="s">"padding-top: 75px"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Create account<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;span&gt;</span>Name: <span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span><span class="err">,</span> <span class="na">required=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;span&gt;</span>Email: <span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"email"</span> <span class="na">name=</span><span class="s">"email"</span><span class="err">,</span> <span class="na">required=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;span&gt;</span>Password: <span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span><span class="err">,</span> <span class="na">required=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;span&gt;</span>Re-type Password: <span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span><span class="err">,</span> <span class="na">required=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;br&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/section&gt;</span>
{% endblock %}<span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><img src="/assets/2017-08-12/register.png" alt="register" /></p>

<p>Again, this code does nothing, except it looks good in the browser. All the magic like validation, verification will happen  behind the stage, described in details in next sections.</p>

<h3 id="mongodb">MongoDB</h3>

<p>Before we dive into login/register python machinery I would like to address few topics related to this issue. First is database choice. I decided to store user provided information and data received from social media providers in NoSQL database - <a href="https://www.mongodb.com">MongoDB</a>. Main reason is that different providers have different data models. Friends, followers lists, text or media content of the posts, software repositories. Variety makes nearly impossible to fit them in some sane common relational database. In MongoDB, JSON like format of the data is playing nicely with the data format given by providers (API requests return JSON responses). JSON can be easily manipulated in python and converted tot he dictionary container. It is also very easy to store and manipulate graph-type data. To communicate with db we will use excellent Flask extension: <a href="http://flask-pymongo.readthedocs.io/en/latest/"><code class="highlighter-rouge">flask_pymongo</code></a>. Pip install it <code class="highlighter-rouge">pip install flask_pymongo</code> if package is not installed on your system.</p>

<p><br /></p>
<div class="alert alert-info" role="alert" style="text-align: justify; vertical-align:middle;">
This step assumes, you have MongoDB server up and running on your local machine. Refer to <a href="https://docs.mongodb.com/manual/administration/install-community/"><strong>MongoDB documentation</strong></a> for installation details.
</div>

<p>First lets register PyMongo extension (and add <code class="highlighter-rouge">flask_pymongo==0.5.1</code> to the requirements list in production):</p>

<p><strong>/app/extensions.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="o">...</span>
<span class="kn">from</span> <span class="nn">flask_pymongo</span> <span class="kn">import</span> <span class="n">PyMongo</span>

<span class="o">...</span>
<span class="n">mongo</span> <span class="o">=</span> <span class="n">PyMongo</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>And add to <code class="highlighter-rouge">register_extensions()</code> in main application:</p>

<p><strong>/app/app.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre>      
<span class="kn">from</span> <span class="nn">app.extensions</span> <span class="kn">import</span> <span class="n">debug_toolbar</span><span class="p">,</span> <span class="n">mongo</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">public</span>

<span class="o">...</span>
<span class="k">def</span> <span class="nf">register_extensions</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="s">"""Register Flask extensions."""</span>
    <span class="n">debug_toolbar</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Debug toolbar initialized"</span><span class="p">)</span>
    <span class="n">mongo</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Debug mongo initialized"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This will attach PyMongo db to the current app using default name or name specified in <code class="highlighter-rouge">settings.py</code> file.</p>

<h3 id="sessions">Sessions</h3>

<p>Sometimes  URL’s contain additional parameters submitted in the URL (i.e <code class="highlighter-rouge">http://www.domain.com/endpoint?key=value</code>). One can access them via Flask request object (<code class="highlighter-rouge">request.args</code> attribute) and store them in the cookies attribute (<code class="highlighter-rouge">request.cookies</code>) for later usage. However using cookies is not preferred to store requests data, especially sensitive one like credentials or authorization tokens, therefore it is recommended to use more secure solution and it is__session__.</p>

<p>Session stores request parameters specific to a user from one request to the next. But it does it in more secure way, by adding additional security layer on top of cookies. To secure data serialized in cookie it uses secret key provided by the app. User can not modify session parameters, unless has access to this key. In our case we will use app configuration to set strong secret key with <code class="highlighter-rouge">os.urandom(24)</code>, which generates 24 random bytes suitable for cryptographic use. We set this parameter as a <code class="highlighter-rouge">SECRET_KEY</code> in base class of the config file. Configuration key is inherited by all child classes, and passed further to each app instance upon app creation by <code class="highlighter-rouge">create_app()</code> function.</p>

<p>Session or cookie usually resides on client side. We will go one step further and use Flask extension to manage server side sessions in our app. Because our app is meant to analyze social media data, it will certainly have to be able to gather and process amounts of data above average cookie capacity (counted in tens or even hundreds of MB). And we do not want to send hundreds of megabytes through Internet from our server, where app runs, to the clients browser. To make it possible we will use very handy Redis NoSQL database, which can operate in memory and store data in form of key:value pairs. Here we will use Redis to store session data. Extension will hook up to the app and allow to use it through standard Flask session object.</p>

<p><br /></p>
<div class="alert alert-info" role="alert" style="text-align: justify; vertical-align:middle;">
To run application locally, you need to have Redis server running on your local machine. Refer to Redis documentation for <a href="https://redis.io/documentation">installation details</a>.
</div>

<p>Fortunatelly we do not have to write our own Redis interface to interact with it. Flask-Session will take care for it, using some default settings and some values taken from app configuration. However few things must be done to use Redis as a server side session storage:</p>

<ol>
  <li>Add <code class="highlighter-rouge">SESSION_TYPE = 'redis'</code> to the config file</li>
  <li>Download, install and add Flask-Session extension (don’t forget to add Flask-Session==0.3.1 to <code class="highlighter-rouge">requirements/prod.txt</code>)</li>
</ol>

<p><strong>/app/settings.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="n">SESSION_TYPE</span> <span class="o">=</span> <span class="s">'redis'</span>
<span class="o">...</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Once it is done we can append <code class="highlighter-rouge">extensions.py</code>with Flask-Session initialization:</p>

<p><strong>/app/extensions.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="o">...</span>
<span class="kn">from</span> <span class="nn">flask_session</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="o">...</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>and register it with the app:</p>

<p><strong>/app/app.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">app.extensions</span> <span class="kn">import</span> <span class="n">debug_toolbar</span><span class="p">,</span> <span class="n">mongo</span><span class="p">,</span> <span class="n">login_manager</span><span class="p">,</span> <span class="n">sess</span>

<span class="k">def</span> <span class="nf">register_extensions</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="s">"""Register Flask extensions."""</span>
    <span class="n">debug_toolbar</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">mongo</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">login_manager</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Finally lets use it in our app. Lets make session to store users data during registration and then compare them during signing in. This is just temporary solution, to show how session works. Our primary storage will be MongoDB and Redis will serve as a cache to keep some data obtained from API’s of social media providers. Processed data will be also stored in MongoDB.</p>

<p><strong>/app/public/views.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">session</span>


<span class="n">blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s">'public'</span><span class="p">,</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s">'../static'</span><span class="p">)</span>


<span class="nd">@blueprint.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="s">"""Home page."""</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'public/home.html'</span><span class="p">)</span>


<span class="nd">@blueprint.route</span><span class="p">(</span><span class="s">'/login'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="s">"""Login page."""</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'public/login.html'</span><span class="p">)</span>


<span class="nd">@blueprint.route</span><span class="p">(</span><span class="s">'/register'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="s">"""Register page."""</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'public/register.html'</span><span class="p">)</span>


<span class="nd">@blueprint.route</span><span class="p">(</span><span class="s">'/logout'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="s">"""logout link."""</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span></code></pre></figure>

<h3 id="flask-login">Flask-Login</h3>

<p>To restrict</p>
<h3 id="data-storage">Data storage</h3>

<ol>
  <li>MongoDB,</li>
  <li>security with bcrypt - password passed in POST http call.</li>
</ol>

<p><strong>/app/settings.py</strong></p>

<h3 id="user-model">User model</h3>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">(</span>md_analytics<span class="o">)</span> <span class="o">[</span>mdyzma@devbox md_analytics]<span class="nv">$ </span>tree .
.
|-- app/
|   |-- user/
|   |   |
|   |   |-- static/
|   |   |
|   |   |-- templates/
|   |   |   |
|   |   |   <span class="sb">`</span>-- user.html
|   |   |
|   |   <span class="sb">`</span>-- views.py
...</code></pre></figure>

<h2 id="summary">Summary</h2>

<!-- Links -->

<!-- Images -->


  </div>
<div class="container">
    <div class="row ">
        <div class="col-xs-2"></div>
        <div class="col-xs-8">

        <!-- Twitter -->
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="MichalDyzma">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

        <!-- Google + -->
        <div class="g-plus" data-action="share" data-annotation="bubble"></div>
        <script src="https://apis.google.com/js/platform.js" async defer></script>

        <!-- Facebook -->
        <div class="fb-share-button" data-href="http://localhost:4000/2017/08/12/social-media-analysis-part-ii/" data-layout="button_count" data-size="small" data-mobile-iframe="true" style="position: relative; top: -8px;"></div>


        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/pl_PL/sdk.js#xfbml=1&version=v2.9&appId=422251294815916";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>

    </div>
    </div>
    <div class="col-xs-2"></div>
</div>


<div id="disqus_thread"></div>
    <script type="text/javascript">

        var disqus_config = function () {
            this.page.url = "http://localhost:4000/2017/08/12/social-media-analysis-part-ii/";
            this.page.identifier = "/2017/08/12/social-media-analysis-part-ii";
        };
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'md-blog';
        var disqus_developer = 1; // Comment out when the site is live

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var d = document, s = d.createElement('script');
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript"></noscript>


</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy; Michal Dyzma - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="http://localhost:4000/feed.xml">RSS</a>


<!-- mathjax -->



<!-- Bootstrap core JavaScript
================================================== -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


    </p>

  </div>

</footer>


  </body>

</html>
